<!DOCTYPE html>
<html>
<head>
</head>
<body>

<h1> Groceries price comparator </h1>

<p> Would you like to search for the prices of some groceries? Type the name of the food in the box! </p>

<label for 'product'> Product Name: </label>
<input type="text" id='inputSearchData' name='searchProduct'> <br><br>
<button onClick='searchProductFunction();'> Search Product </button>

<p> Here are the product data you wanted. </p>
<table id='productDataTable'>
<tr> <th>ID</th> <th>Name</th> <th>Price</th> <th>Retailer</th> <th>URL</th> </tr>
<tr> <td>1</td> <td>Peppers</td> <td>31.93</td> <td>Walmart</td> <td>https://www.walmart.com/ip/Peppers-7-OZ-Pack-of-12/139941530</td> </tr>
<tr> <td>2</td> <td>Peppers</td> <td>42.39</td> <td>Target</td> <td>https://www.target.com/ip/Peppers-7-OZ-Pack-of-12/139941531</td> </tr>
<tr> <td>3</td> <td>Peppers</td> <td>56.91</td> <td>Aldi</td> <td>https://www.aldi.com/ip/Peppers-7-OZ-Pack-of-12/139941532</td> </tr>
</table>

<p> Would you like to search for the <i>average</i> prices of some groceries?  </p>

<button onClick='searchItemAveragePricesFunction();'> Search Average Prices </button>

<p> Here are the average prices of all products. </p>
<table id='averageItemPricesTable'>
<tr> <th>ID</th> <th>Name</th> <th>Average Price</th> </tr>
<tr> <td>1</td> <td>Peppers</td> <td>31.93</td> </tr>
<tr> <td>2</td> <td>Cucumbers</td> <td>42.39</td> </tr>
<tr> <td>3</td> <td>Cabbage</td> <td>56.91</td> </tr>
</table>

<p> Would you like to know what are the <i>average prices of all items at each supermarket??</i> </p>

<button onClick='searchRetailerAveragePricesFunction();'> Search Average Prices </button>

<p> Here are the average prices of all products. </p>
<table id='averageRetailerPricesTable'>
<tr> <th>Retailer</th> <th>Average Price</th> </tr>
<tr> <td>Target</td> <td>31.93</td> </tr>
<tr> <td>Walmart</td> <td>42.39</td> </tr>
<tr> <td>Aldi</td> <td>56.91</td> </tr>
</table>

<p> Would you like to insert some data on new products? Type the new data in the boxes and we'll insert it into our database! </p>

<label for 'food'> Food: </label>
<input type="text" id='insertProduct' name='food'> <br><br>

<label for 'place'> Place: </label>
<input type="text" id='insertRetailer' name='place'> <br><br>

<label for 'price'> Price: </label>
<input type="number" step="0.01" id='insertPrice' name='price'> <br><br>

<label for 'place'> URL: </label>
<input type="text" id='insertURL' name='url'> <br><br>

<button onClick='insertDataFunction();'> Insert Product </button>

<p> Would you like to update some data on currently existing products? Type in your up-to-date data in the boxes and we'll update it in our database! </p>

<label for 'food'> Product ID: </label>
<input type="text" id='updateID' name='id'> <br><br>

<label for 'price'> Price: </label>
<input type="number" step="0.01" id='updatePrice' name='price'> <br><br>

<button onClick='updateDataFunction();'> Update Product </button>

<p> Is there a product in our database that doesn't exist anymore? Type the product ID in the box and we'll delete it from our database! </p>

<label for 'food'> Product ID: </label>
<input type="text" id='deleteID' name='id'> <br><br>

<button onClick='deleteDataFunction();'> Delete Data </button>


<script>
	function searchProductFunction() {
		var xhttp = new XMLHttpRequest();
		xhttp.onreadystatechange = function() {
            if (this.readyState == 4 && this.status == 200) {
				let resp = JSON.parse(xhttp.responseText);
				console.log(resp);
				let content = '<tr> <th>ID</th> <th>Name</th> <th>Price</th> <th>Retailer</th> <th>URL</th> </tr>';
				resp['productData'].forEach(x=> {
					content += '<tr><td>' + x['ID'] + '</td><td>' + x['Name'] + '</td><td>' + x['Price'] + '</td><td>' + x['Retailer'] + '</td><td>' + x['URL'] + '</td></tr>'
				});
				document.getElementById("productDataTable").innerHTML = content;
			}
		};
		xhttp.open("GET", "/getProductData", true);
		xhttp.send();
	}
	function searchItemAveragePricesFunction() {
		var xhttp = new XMLHttpRequest();
		xhttp.onreadystatechange = function() {
            if (this.readyState == 4 && this.status == 200) {
				let resp = JSON.parse(xhttp.responseText);
				console.log(resp);
				let content = '<tr> <th>ID</th> <th>Name</th> <th>Price</th> </tr>';
				resp['averagePrices'].forEach(x=> {
					content += '<tr><td>' + x['ID'] + '</td><td>' + x['Name'] + '</td><td>' + x['Price'] + '</td></tr>'
				});
				document.getElementById("averageItemPricesTable").innerHTML = content;
			}
		};
		xhttp.open("GET", "/getAveragePrices", true);
		xhttp.send();
	}
	function insertDataFunction() {
		var xhttp = new XMLHttpRequest();
		xhttp.open("POST", "/postProductData", true);
	}
	function updateDataFunction() {
		var xhttp = new XMLHttpRequest();
		xhttp.open("POST", "/postUpdateData", true);
	}
	function deleteDataFunction() {
		var xhttp = new XMLHttpRequest();
		xhttp.open("POST", "/postDelete", true);
	}

	// function addData() {
	// 		var xhttp = new XMLHttpRequest();
	// 		xhttp.onreadystatechange = function() {
	// 				if (this.readyState == 4 && this.status == 200){
	// 						getDatas();
	// 				}
	// 		};
	// 		xhttp.open("POST", "/addData", true);
	// 		xhttp.setRequestHeader('Content-Type', 'application/json;charset=UTF-8');
	// 		xhttp.send(JSON.stringify({
	// 	"food" : document.getElementById('inputFood').value,
	// 	"place": document.getElementById('inputPlace').value,
	// 	"price": document.getElementById('inputPrice').value
	// }));
	// }

	// searchAveragePricesFunction();

</script>

</body>
</html>
